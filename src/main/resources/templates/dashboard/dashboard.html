<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</title>
  <link rel="stylesheet" th:href="@{/css/dashboard.css}">
</head>
<body>
<div class="dashboard-container">
  <header class="dashboard-header">
    <h1>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
    <form th:action="@{/auth/logout}" method="post">
      <button type="submit">ë¡œê·¸ì•„ì›ƒ</button>
    </form>
  </header>

  <!-- ì•Œë¦¼ í‘œì‹œ ì˜ì—­ -->
  <div id="alert-area" style="margin: 1rem 0;"></div>

  <main class="dashboard-content">
    <section class="dashboard-card">
      <h2>
        íšŒì›ê°€ì… ìš”ì²­
        <span id="signup-badge"
              style="display:none; background:red; color:white; border-radius:50%; padding:2px 8px; margin-left:6px; font-size:0.8rem;">0</span>
      </h2>
      <p>ìƒˆë¡œìš´ ì‚¬ìš©ì ê°€ì… ìš”ì²­ì„ í™•ì¸í•˜ê³  ìŠ¹ì¸í•˜ê±°ë‚˜ ê±°ì ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      <a href="/admin/users/pending" class="button">ê°€ì… ìš”ì²­ ë³´ê¸°</a>
    </section>

    <section class="dashboard-card">
      <h2>ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§</h2>
      <p>ì„œë²„ ìì› ì‚¬ìš©ë¥ ì„ í™•ì¸í•©ë‹ˆë‹¤.</p>
      <a href="/admin/system/status" class="button">ëª¨ë‹ˆí„°ë§ ë³´ê¸°</a>
    </section>

    <section class="dashboard-card">
      <h2>ì±„íŒ… ë‚´ì—­</h2>
      <p>ì‚¬ìš©ì ê°„ì˜ ì±„íŒ…ë°© ë° ê¸°ë¡ì„ ì¡°íšŒí•©ë‹ˆë‹¤.</p>
      <a href="/admin/chats" class="button">ì±„íŒ… ê¸°ë¡ ë³´ê¸°</a>
    </section>
  </main>
</div>

<!-- SSE ì•Œë¦¼ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
  const sse = new EventSource("/sse/notification");
  let signupAlertCount = 0;

  sse.addEventListener("member-signup", function (e) {
    // ì•Œë¦¼ ë©”ì‹œì§€ êµì²´
    const alertArea = document.getElementById("alert-area");
    alertArea.innerHTML = ""; // ê¸°ì¡´ ì•Œë¦¼ ì œê±°

    const alertBox = document.createElement("div");
    alertBox.textContent = "ğŸ”” ê°€ì… ìš”ì²­: " + e.data;
    alertBox.style = "background: #fff3cd; padding: 10px; margin-bottom: 10px; border: 1px solid #ffeeba; border-radius: 4px;";
    alertArea.appendChild(alertBox);

    // ì•Œë¦¼ ë°°ì§€ ì—…ë°ì´íŠ¸
    signupAlertCount++;
    const badge = document.getElementById("signup-badge");
    badge.textContent = signupAlertCount;
    badge.style.display = "inline-block";
  });

  sse.onerror = function () {
    console.warn("SSE ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤.");
  };
</script>

</body>
</html>
